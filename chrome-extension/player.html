<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixSim7 Video Player</title>
  <link rel="stylesheet" href="dist/dockview.css">
  <style>
    :root {
      --bg: #1a1a2e;
      --bg-alt: #16213e;
      --accent: #e94560;
      --accent-hover: #ff6b6b;
      --text: #eee;
      --text-muted: #888;
      --border: #333;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      cursor: default;
      overflow: hidden;
    }

    /* Prevent text selection except in inputs */
    body *:not(input):not(textarea) {
      user-select: none;
    }

    .header {
      padding: 8px 12px;
      background: var(--bg-alt);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .header h1 {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .header-actions {
      display: flex;
      gap: 6px;
      margin-left: auto;
    }

    .btn {
      padding: 5px 10px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

    .btn-secondary {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { background: var(--border); }

    /* Dockview container */
    #dockviewContainer {
      flex: 1;
      min-height: 0;
    }

    /* Dockview dark theme overrides */
    .dockview-theme-dark {
      --dv-activegroup-visiblepanel-tab-background-color: var(--bg-alt);
      --dv-activegroup-hiddenpanel-tab-background-color: var(--bg);
      --dv-inactivegroup-visiblepanel-tab-background-color: var(--bg);
      --dv-inactivegroup-hiddenpanel-tab-background-color: var(--bg);
      --dv-tab-divider-color: var(--border);
      --dv-activegroup-visiblepanel-tab-color: var(--text);
      --dv-activegroup-hiddenpanel-tab-color: var(--text-muted);
      --dv-inactivegroup-visiblepanel-tab-color: var(--text-muted);
      --dv-inactivegroup-hiddenpanel-tab-color: var(--text-muted);
      --dv-background-color: var(--bg);
      --dv-paneview-header-border-color: var(--border);
      --dv-separator-border: var(--border);
      --dv-icon-hover-background-color: var(--border);
    }

    /* Panel content styles */
    .panel-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Video panel */
    .video-panel-content {
      background: #000;
      position: relative;
    }

    .video-panel-content video {
      max-width: 100%;
      max-height: 100%;
      user-select: none;
    }

    .video-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      overflow: auto;
      position: relative;
      min-height: 0;
    }

    .video-container.has-region {
      cursor: default;
    }

    .video-container.has-region * {
      user-select: none;
    }

    .drop-zone {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      background: rgba(0,0,0,0.8);
      border: 3px dashed var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .drop-zone:hover, .drop-zone.dragover {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.1);
    }

    .drop-zone.hidden { display: none; }
    .hidden { display: none !important; }

    .drop-zone-icon { font-size: 48px; opacity: 0.6; }
    .drop-zone-text { font-size: 14px; color: var(--text-muted); }
    .drop-zone-hint { font-size: 12px; color: var(--text-muted); opacity: 0.7; }

    /* Conversion progress overlay */
    .convert-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      z-index: 20;
    }

    .convert-overlay.hidden { display: none; }

    .convert-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .convert-text {
      font-size: 14px;
      color: var(--text);
    }

    .convert-progress {
      width: 200px;
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
    }

    .convert-progress-bar {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width 0.2s;
    }

    .convert-detail {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Region selection overlay */
    .region-overlay {
      position: absolute;
      inset: 0;
      cursor: crosshair;
      z-index: 10;
      user-select: none;
    }

    .region-overlay.hidden { display: none; }

    .video-container:has(.region-box:not(.hidden)) {
      cursor: default;
    }

    .video-container:has(.region-box:not(.hidden)) video {
      pointer-events: none;
    }

    .region-box {
      position: absolute;
      border: 2px dashed var(--accent);
      background: rgba(233, 69, 96, 0.15);
      cursor: move;
      user-select: none;
    }

    .region-box.hidden { display: none; }

    .region-handle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--accent);
      border: 1px solid white;
      border-radius: 2px;
    }

    .region-handle.nw { top: -5px; left: -5px; cursor: nw-resize; }
    .region-handle.ne { top: -5px; right: -5px; cursor: ne-resize; }
    .region-handle.sw { bottom: -5px; left: -5px; cursor: sw-resize; }
    .region-handle.se { bottom: -5px; right: -5px; cursor: se-resize; }

    .region-clear {
      position: absolute;
      top: -8px;
      right: -8px;
      background: rgba(0,0,0,0.8);
      border: 1px solid var(--accent);
      color: white;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
    }

    .region-clear:hover { background: var(--accent); }

    .region-info {
      position: absolute;
      bottom: 4px;
      left: 4px;
      background: rgba(0,0,0,0.7);
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      color: white;
      pointer-events: none;
    }

    /* Blur controls */
    .blur-controls {
      position: absolute;
      bottom: -36px;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0,0,0,0.85);
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 11px;
      z-index: 10;
    }

    .blur-controls.hidden { display: none; }

    .blur-label {
      color: var(--text-muted);
      white-space: nowrap;
    }

    .blur-slider {
      flex: 1;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--border);
      border-radius: 2px;
      cursor: pointer;
    }

    .blur-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
    }

    .blur-value {
      color: var(--text);
      min-width: 32px;
      text-align: right;
      font-family: monospace;
    }

    .blur-preview {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 5;
    }

    /* Contain video mode */
    .video-container.contain-video {
      overflow: hidden;
    }

    .video-container.contain-video video {
      max-width: none;
      max-height: none;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Controls panel */
    .controls-panel-content {
      background: var(--bg-alt);
      padding: 8px 10px;
    }

    .controls-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .controls-row:last-child {
      margin-bottom: 0;
    }

    .seek-bar {
      flex: 1;
      height: 16px;
      background: var(--border);
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      user-select: none;
      overflow: hidden;
    }

    .seek-bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      width: 0%;
      transition: width 0.1s;
    }

    .seek-marker {
      position: absolute;
      top: 0;
      width: 2px;
      height: 100%;
      background: rgba(255,255,255,0.5);
      pointer-events: none;
      border-radius: 1px;
    }

    .seek-marker.current {
      background: var(--accent);
      width: 3px;
    }

    .time-display {
      font-size: 12px;
      font-family: monospace;
      color: var(--text-muted);
      min-width: 100px;
      text-align: center;
    }

    .playback-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .playback-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: none;
      background: var(--bg);
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      transition: all 0.15s;
    }

    .playback-btn:hover { background: var(--border); }
    .playback-btn.play { background: var(--accent); }
    .playback-btn.play:hover { background: var(--accent-hover); }

    .frame-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
    }

    .frame-input {
      width: 60px;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 12px;
      text-align: center;
    }

    .speed-select {
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 12px;
      cursor: pointer;
    }

    .video-info {
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      gap: 16px;
    }

    .setting-slider {
      flex: 1;
      height: 4px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--border);
      border-radius: 2px;
      cursor: pointer;
    }

    .setting-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
    }

    .setting-value {
      font-size: 11px;
      font-family: monospace;
      color: var(--text-muted);
      min-width: 40px;
      text-align: right;
    }

    /* Settings panel - uses fixed positioning to escape dockview stacking context */
    .settings-panel {
      position: fixed;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 12px;
      min-width: 240px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .settings-panel.hidden { display: none; }

    .settings-section {
      margin-bottom: 12px;
    }

    .settings-section:last-child { margin-bottom: 0; }

    .settings-title {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .setting-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .setting-row:last-child { margin-bottom: 0; }

    .setting-label {
      font-size: 11px;
      color: var(--text);
      min-width: 70px;
    }

    .settings-btn {
      position: relative;
    }

    /* Hotkey settings */
    .hotkey-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 10px;
    }

    .hotkey-label {
      flex: 1;
      color: var(--text-muted);
      min-width: 80px;
    }

    .hotkey-btn {
      padding: 3px 8px;
      border-radius: 3px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 10px;
      font-family: monospace;
      cursor: pointer;
      min-width: 60px;
      text-align: center;
      transition: all 0.15s;
    }

    .hotkey-btn:hover { border-color: var(--accent); }
    .hotkey-btn.recording {
      border-color: var(--accent);
      background: rgba(233, 69, 96, 0.2);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Playlist panel */
    .playlist-panel-content {
      background: var(--bg-alt);
    }

    .playlist-header {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .playlist-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text);
    }

    .playlist-header-actions {
      display: flex;
      gap: 4px;
    }

    .playlist-header-actions button {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 2px 4px;
      font-size: 11px;
      border-radius: 3px;
      transition: all 0.15s;
    }

    .playlist-header-actions button:hover {
      background: var(--border);
      color: var(--text);
    }

    .playlist-items {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .playlist-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.15s;
      position: relative;
    }

    .playlist-item:hover {
      background: rgba(255,255,255,0.05);
    }

    .playlist-item.active {
      background: rgba(233, 69, 96, 0.15);
      border-left: 3px solid var(--accent);
      padding-left: 5px;
    }

    .playlist-item-thumb {
      width: 48px;
      height: 27px;
      background: var(--bg);
      border-radius: 3px;
      flex-shrink: 0;
      object-fit: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--text-muted);
    }

    .playlist-item-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 3px;
    }

    .playlist-item-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .playlist-item-name {
      font-size: 10px;
      color: var(--text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .playlist-item-meta {
      font-size: 9px;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .playlist-item-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0,0,0,0.6);
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 2px 4px;
      font-size: 9px;
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .playlist-item:hover .playlist-item-remove {
      opacity: 1;
    }

    .playlist-item-remove:hover {
      background: var(--accent);
      color: white;
    }

    .playlist-empty {
      padding: 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
    }

    /* Library panel */
    .library-panel-content {
      background: var(--bg-alt);
    }

    .library-header {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .library-folder-select {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .library-folder-select select {
      flex: 1;
      padding: 4px 6px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 11px;
      min-width: 0;
    }

    .library-folder-select .btn {
      padding: 4px 8px;
      font-size: 12px;
      min-width: 28px;
    }

    .library-grid {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 8px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
      align-content: start;
    }

    .library-empty {
      grid-column: 1 / -1;
      padding: 30px 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
    }

    .library-item {
      aspect-ratio: 16 / 9;
      background: var(--bg);
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      position: relative;
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .library-item:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .library-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .library-item-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--text-muted);
    }

    .library-item-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 4px 6px;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      font-size: 9px;
      color: white;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .library-item-type {
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 10px;
      background: rgba(0,0,0,0.6);
      padding: 1px 4px;
      border-radius: 2px;
    }

    .library-status {
      padding: 4px 8px;
      font-size: 10px;
      color: var(--text-muted);
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }

    .library-status:empty {
      display: none;
    }

    .library-loading {
      grid-column: 1 / -1;
      padding: 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
    }

    /* Dropdowns */
    .history-btn, .region-mode-btn, .player-settings-btn {
      position: relative;
    }

    .history-dropdown, .region-mode-dropdown, .player-settings-popup {
      position: absolute;
      top: 100%;
      margin-top: 4px;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      border-radius: 6px;
      z-index: 50;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .history-dropdown {
      left: 0;
      min-width: 200px;
      max-width: 300px;
      max-height: 250px;
      overflow-y: auto;
    }

    .history-dropdown.hidden { display: none; }

    .history-item {
      padding: 8px 12px;
      font-size: 11px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .history-item:last-child { border-bottom: none; }
    .history-item:hover { background: var(--border); }

    .history-item-icon {
      opacity: 0.6;
      flex-shrink: 0;
    }

    .history-item-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .history-item-type {
      font-size: 9px;
      color: var(--text-muted);
      padding: 1px 4px;
      background: var(--bg);
      border-radius: 3px;
      flex-shrink: 0;
    }

    .history-empty {
      padding: 12px;
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
    }

    .region-mode-dropdown {
      left: 0;
      min-width: 120px;
      overflow: hidden;
    }

    .region-mode-dropdown.hidden { display: none; }

    .region-mode-btn .btn {
      display: flex;
      align-items: center;
      gap: 2px;
    }

    .region-mode-btn .dropdown-arrow {
      font-size: 8px;
      opacity: 0.7;
    }

    .region-mode-btn .btn.active {
      background: var(--accent);
      color: white;
    }

    .region-mode-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      font-size: 11px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
    }

    .region-mode-option:last-child {
      border-bottom: none;
    }

    .region-mode-option:hover {
      background: var(--border);
    }

    .region-mode-option.selected {
      background: rgba(233, 69, 96, 0.2);
    }

    .region-mode-option .hotkey-hint {
      margin-left: auto;
      opacity: 0.5;
      font-size: 10px;
    }

    .player-settings-popup {
      right: 0;
      padding: 10px 12px;
      min-width: 180px;
    }

    .player-settings-popup.hidden { display: none; }

    .player-settings-popup .settings-title {
      margin-bottom: 10px;
    }

    .player-settings-option {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      cursor: pointer;
      padding: 4px 0;
    }

    .player-settings-option input[type="checkbox"] {
      cursor: pointer;
      accent-color: var(--accent);
    }

    /* View menu dropdown */
    .view-menu-btn {
      position: relative;
    }

    .view-menu-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      border-radius: 6px;
      z-index: 50;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      min-width: 140px;
      overflow: hidden;
    }

    .view-menu-dropdown.hidden { display: none; }

    .view-menu-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      font-size: 11px;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
    }

    .view-menu-option:last-child {
      border-bottom: none;
    }

    .view-menu-option:hover {
      background: var(--border);
    }

    .view-menu-check {
      width: 14px;
      color: var(--accent);
      font-size: 10px;
    }

    .view-menu-check.hidden {
      visibility: hidden;
    }

    .view-menu-separator {
      height: 1px;
      background: var(--border);
      margin: 4px 0;
    }

    /* URL input */
    .url-input-container {
      display: flex;
      gap: 8px;
    }

    .url-input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-size: 13px;
    }

    .url-input::placeholder { color: var(--text-muted); }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 100;
      user-select: none;
      pointer-events: none;
      cursor: default;
    }
    .toast.visible { opacity: 1; }
    .toast.success { border-color: #4ade80; }
    .toast.error { border-color: #f87171; }

    /* Panel templates - hidden until cloned by dockview */
    .panel-template {
      display: none !important;
    }

    /* Responsive */
    @media (max-height: 400px) {
      .header { padding: 4px 8px; }
      .header h1 { font-size: 11px; }
      .playback-btn { width: 24px; height: 24px; font-size: 10px; }
      .seek-bar { height: 12px; }
      .btn { padding: 3px 6px; font-size: 10px; }
    }

    @media (max-width: 500px) {
      .header { flex-wrap: wrap; }
      .url-input-container { order: 3; width: 100%; min-width: unset; margin-top: 4px; }
      .frame-controls { display: none; }
    }

    @media (max-width: 400px) {
      .header h1 { display: none; }
      .time-display { font-size: 10px; min-width: 70px; }
      .speed-select { display: none; }
    }
  </style>
</head>
<body>
  <!-- Header (outside dockview) -->
  <div class="header">
    <h1>Video Player</h1>
    <div class="url-input-container" style="flex: 1; min-width: 150px;">
      <input type="text" class="url-input" id="urlInput" placeholder="Paste URL..." style="font-size: 11px; padding: 5px 8px;">
      <button class="btn btn-secondary" id="loadUrlBtn">Load</button>
    </div>
    <div class="header-actions">
      <div class="view-menu-btn">
        <button class="btn btn-secondary" id="viewMenuBtn" title="View panels">‚ò∞</button>
        <div class="view-menu-dropdown hidden" id="viewMenuDropdown">
          <div class="view-menu-option" data-panel="video">
            <span class="view-menu-check" id="viewCheckVideo">‚úì</span>
            <span>Video</span>
          </div>
          <div class="view-menu-option" data-panel="playlist">
            <span class="view-menu-check" id="viewCheckPlaylist">‚úì</span>
            <span>Playlist</span>
          </div>
          <div class="view-menu-option" data-panel="library">
            <span class="view-menu-check" id="viewCheckLibrary">‚úì</span>
            <span>Library</span>
          </div>
          <div class="view-menu-option" data-panel="controls">
            <span class="view-menu-check" id="viewCheckControls">‚úì</span>
            <span>Controls</span>
          </div>
          <div class="view-menu-separator"></div>
          <div class="view-menu-option" data-action="reset">
            <span class="view-menu-check" style="visibility:hidden">‚úì</span>
            <span>Reset Layout</span>
          </div>
        </div>
      </div>
      <div class="history-btn">
        <button class="btn btn-secondary" id="historyBtn" title="Recent videos">üïí</button>
        <div class="history-dropdown hidden" id="historyDropdown"></div>
      </div>
      <button class="btn btn-secondary" id="openFileBtn" title="Open file">üìÅ</button>
      <div class="region-mode-btn">
        <button class="btn btn-secondary" id="regionModeBtn" disabled title="Select region (R/P)">
          <span id="regionModeIcon">‚¨ö</span>
          <span class="dropdown-arrow">‚ñæ</span>
        </button>
        <div class="region-mode-dropdown hidden" id="regionModeDropdown">
          <div class="region-mode-option" data-mode="rect">
            <span>‚¨ö</span>
            <span>Rectangle</span>
            <span class="hotkey-hint">R</span>
          </div>
          <div class="region-mode-option" data-mode="polygon">
            <span>‚¨°</span>
            <span>Polygon</span>
            <span class="hotkey-hint">P</span>
          </div>
        </div>
      </div>
      <div class="player-settings-btn">
        <button class="btn btn-secondary" id="playerSettingsBtn" title="Player settings">‚öô</button>
        <div class="player-settings-popup hidden" id="playerSettingsPopup">
          <div class="settings-title">Player Settings</div>
          <label class="player-settings-option">
            <input type="checkbox" id="containVideoCheck">
            <span>Contain video in window</span>
          </label>
          <label class="player-settings-option">
            <input type="checkbox" id="skipDedupCheck">
            <span>Skip similar image check</span>
          </label>
          <label class="player-settings-option">
            <input type="checkbox" id="resetLayoutCheck">
            <span>Reset panel layout</span>
          </label>
        </div>
      </div>
      <button class="btn btn-secondary" id="saveAssetBtn" disabled title="Save to assets only (S)">üíæ</button>
      <button class="btn btn-primary" id="captureBtn" disabled title="Upload to Pixverse (C)">üì∏</button>
    </div>
  </div>

  <!-- Dockview container -->
  <div id="dockviewContainer"></div>

  <!-- Panel templates (cloned by dockview) -->

  <!-- Video Panel Template -->
  <div id="videoPanel" class="panel-template">
    <div class="panel-content video-panel-content">
      <div class="video-container" id="videoContainer">
        <video id="video" crossorigin="anonymous"></video>
        <div class="region-overlay hidden" id="regionOverlay"></div>
        <canvas class="blur-preview hidden" id="blurPreview"></canvas>
        <div class="region-box hidden" id="regionBox">
          <div class="region-handle nw" data-handle="nw"></div>
          <div class="region-handle ne" data-handle="ne"></div>
          <div class="region-handle sw" data-handle="sw"></div>
          <div class="region-handle se" data-handle="se"></div>
          <button class="region-clear" id="regionClear" title="Clear region">‚úï</button>
          <div class="region-info" id="regionInfo"></div>
          <div class="blur-controls hidden" id="blurControls">
            <span class="blur-label">Blur:</span>
            <input type="range" class="blur-slider" id="blurSlider" min="0" max="30" value="0">
            <span class="blur-value" id="blurValue">0px</span>
          </div>
        </div>
        <div class="drop-zone" id="dropZone">
          <div class="drop-zone-icon" style="font-size: 36px;">üé•</div>
          <div class="drop-zone-text" style="font-size: 12px;">Drop video or click to open</div>
          <div class="drop-zone-hint" style="font-size: 10px;">Supports AVI, MKV, MP4, WebM (auto-converts)</div>
        </div>
        <div class="convert-overlay hidden" id="convertOverlay">
          <div class="convert-spinner"></div>
          <div class="convert-text" id="convertText">Loading FFmpeg...</div>
          <div class="convert-progress">
            <div class="convert-progress-bar" id="convertProgressBar"></div>
          </div>
          <div class="convert-detail" id="convertDetail"></div>
          <button class="btn btn-secondary" id="convertCancel" style="margin-top: 12px;">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Playlist Panel Template -->
  <div id="playlistPanel" class="panel-template">
    <div class="panel-content playlist-panel-content">
      <div class="playlist-header">
        <span class="playlist-title">Playlist</span>
        <div class="playlist-header-actions">
          <button id="playlistClearBtn" title="Clear all">üóë</button>
        </div>
      </div>
      <div class="playlist-items" id="playlistItems"></div>
    </div>
  </div>

  <!-- Library Panel Template -->
  <div id="libraryPanel" class="panel-template">
    <div class="panel-content library-panel-content">
      <div class="library-header">
        <div class="library-folder-select">
          <select id="libraryFolderSelect">
            <option value="">Select folder...</option>
          </select>
          <button class="btn btn-secondary" id="libraryAddFolderBtn" title="Add folder">+</button>
          <button class="btn btn-secondary" id="libraryRemoveFolderBtn" title="Remove folder">‚àí</button>
          <button class="btn btn-secondary" id="libraryRefreshBtn" title="Refresh">‚Üª</button>
        </div>
      </div>
      <div class="library-grid" id="libraryGrid">
        <div class="library-empty">
          <div style="font-size: 24px; margin-bottom: 8px;">üìÅ</div>
          <div>Click + to add a folder</div>
        </div>
      </div>
      <div class="library-status" id="libraryStatus"></div>
    </div>
  </div>

  <!-- Controls Panel Template -->
  <div id="controlsPanel" class="panel-template">
    <div class="panel-content controls-panel-content">
      <div class="controls-row">
        <div class="seek-bar" id="seekBar">
          <div class="seek-bar-fill" id="seekFill"></div>
        </div>
        <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
      </div>

      <div class="controls-row">
        <div class="playback-controls">
          <button class="playback-btn" id="prevFrameBtn" title="‚Üê: 1s | Ctrl: 3s | Shift: frame">‚è™</button>
          <button class="playback-btn play" id="playBtn" title="Play/Pause (Space)">‚ñ∂</button>
          <button class="playback-btn" id="nextFrameBtn" title="‚Üí: 1s | Ctrl: 3s | Shift: frame">‚è©</button>
        </div>

        <select class="speed-select" id="speedSelect" title="Playback speed" style="font-size: 10px; padding: 4px;">
          <option value="0.1">0.1x</option>
          <option value="0.25">0.25x</option>
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="1.5">1.5x</option>
          <option value="2">2x</option>
        </select>

        <div class="volume-controls" style="display: flex; align-items: center; gap: 4px;">
          <button class="playback-btn" id="volumeBtn" title="Mute/Unmute (M)" style="font-size: 12px;">üîä</button>
          <input type="range" class="setting-slider" id="volumeSlider" min="0" max="100" value="100" title="Volume" style="width: 60px;">
          <span class="setting-value" id="volumeValue" style="min-width: 30px; font-size: 10px;">100%</span>
        </div>

        <div class="frame-controls" style="font-size: 10px;">
          <span style="color: var(--text-muted);">F:</span>
          <input type="number" class="frame-input" id="frameInput" value="0" min="0" style="width: 50px; font-size: 10px; padding: 3px;">
          <span style="color: var(--text-muted);">FPS:</span>
          <input type="number" class="frame-input" id="fpsInput" value="30" min="1" max="120" style="width: 40px; font-size: 10px; padding: 3px;">
          <div class="settings-btn">
            <button class="playback-btn" id="settingsBtn" title="Skip settings" style="font-size: 12px;">‚öô</button>
            <div class="settings-panel hidden" id="settingsPanel">
              <div class="settings-section">
                <div class="settings-title">Arrow Key Skip</div>
                <div class="setting-row">
                  <span class="setting-label">Normal:</span>
                  <input type="range" class="setting-slider" id="skipNormal" min="1" max="50" value="10">
                  <span class="setting-value" id="skipNormalVal">1.0s</span>
                </div>
                <div class="setting-row">
                  <span class="setting-label">Ctrl:</span>
                  <input type="range" class="setting-slider" id="skipCtrl" min="10" max="300" value="30">
                  <span class="setting-value" id="skipCtrlVal">3.0s</span>
                </div>
                <div class="setting-row">
                  <span class="setting-label">Shift:</span>
                  <input type="range" class="setting-slider" id="skipShift" min="1" max="30" value="1">
                  <span class="setting-value" id="skipShiftVal">1f</span>
                </div>
              </div>
              <div class="settings-section">
                <div class="settings-title">History</div>
                <div class="setting-row">
                  <label style="font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer;">
                    <input type="checkbox" id="historyEnabled" checked style="cursor: pointer;">
                    Show seek markers
                  </label>
                  <button class="btn btn-secondary" id="clearHistory" style="margin-left: auto; padding: 2px 6px;">Clear</button>
                </div>
              </div>
              <div class="settings-section">
                <div class="settings-title" style="display: flex; align-items: center; justify-content: space-between;">
                  <span>Hotkeys</span>
                  <button class="btn btn-secondary" id="resetHotkeys" style="padding: 2px 6px; font-size: 9px;">Reset</button>
                </div>
                <div class="hotkey-list" id="hotkeyList" style="max-height: 150px; overflow-y: auto;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="video-info" id="videoInfo" style="font-size: 10px; margin-left: auto;"></div>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast" id="toast"></div>

  <!-- Hidden file input -->
  <input type="file" id="fileInput" accept="video/*,.avi,.mkv,.wmv,.flv,.mpeg,.mpg,.m4v,.3gp,.ts,.mts,.m2ts,image/*" style="display: none;">

  <!-- Bundled player scripts -->
  <script src="dist/player.bundle.js"></script>
</body>
</html>
